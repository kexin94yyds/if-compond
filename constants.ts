import { Subscription } from './types';

export const INITIAL_SUBSCRIPTIONS: Subscription[] = [
  { id: '1', url: 'https://twitter.com/SpaceX', name: 'SpaceX (X)', platform: 'twitter', addedAt: 1765146343588 },
  { id: '2', url: 'https://www.youtube.com/@Google', name: 'Google (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '3', url: 'https://www.youtube.com/@NavalR', name: 'NavalR (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '4', url: 'https://twitter.com/dotey', name: 'dotey (X)', platform: 'twitter', addedAt: 1765146343588 },
  { id: '5', url: 'https://www.youtube.com/@rileybrownai', name: 'rileybrownai (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '6', url: 'https://www.youtube.com/@Zendicay', name: 'Zendicay (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '7', url: 'https://www.youtube.com/@itsbyrobin', name: 'itsbyrobin (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '8', url: 'https://www.youtube.com/@Developete', name: 'Developete (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '9', url: 'https://www.youtube.com/@WebDevCody', name: 'WebDevCody (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '10', url: 'https://www.youtube.com/@NetworkChuck', name: 'NetworkChuck (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '11', url: 'https://www.youtube.com/@indydevdan', name: 'indydevdan (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '12', url: 'https://www.youtube.com/@henrikmdev', name: 'henrikmdev (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '13', url: 'https://www.youtube.com/@OpenAI', name: 'OpenAI (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '14', url: 'https://www.youtube.com/@TinaHuang1', name: 'TinaHuang1 (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '15', url: 'https://www.youtube.com/@tech-shrimp', name: 'tech-shrimp (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '16', url: 'https://www.youtube.com/@eoglobal', name: 'eoglobal (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '17', url: 'https://www.youtube.com/@anthropic-ai', name: 'anthropic-ai (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '18', url: 'https://www.youtube.com/@hackbearterry', name: 'hackbearterry (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '19', url: 'https://www.youtube.com/@jackneel', name: 'jackneel (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '20', url: 'https://www.youtube.com/@TEDx', name: 'TEDx (YouTube)', platform: 'youtube', addedAt: 1765146343588 },
  { id: '1765324782067', url: 'https://www.youtube.com/@hubermanlab', name: 'hubermanlab (YouTube)', platform: 'youtube', addedAt: 1765324782067 },
  { id: '1765374028501', url: 'https://www.youtube.com/@EveryInc/videos', name: 'EveryInc (YouTube)', platform: 'youtube', addedAt: 1765374028501 },
  { id: '1765374072954', url: 'https://www.youtube.com/@TraversyMedia', name: 'TraversyMedia (YouTube)', platform: 'youtube', addedAt: 1765374072954 },
  { id: '1765374095226', url: 'https://www.youtube.com/@MoneyXYZ', name: 'MoneyXYZ', platform: 'youtube', addedAt: 1765374095226 },
  { id: '1765374109138', url: 'https://www.youtube.com/@berlinelsewhere', name: 'berlinelsewhere', platform: 'youtube', addedAt: 1765374109138 },
  { id: '1765374122491', url: 'https://www.youtube.com/@ChrisWillx', name: 'ChrisWillx', platform: 'youtube', addedAt: 1765374122491 },
  { id: '1765374138619', url: 'https://www.youtube.com/@KoiAcademy', name: 'KoiAcademy (YouTube)', platform: 'youtube', addedAt: 1765374138619 },
  { id: '1765374156735', url: 'https://www.youtube.com/@RobShocks', name: 'RobShocks', platform: 'youtube', addedAt: 1765374156735 },
  { id: '1765374180499', url: 'https://www.youtube.com/@bigthink', name: 'bigthink (YouTube)', platform: 'youtube', addedAt: 1765374180499 },
  { id: '1765374197826', url: 'https://www.youtube.com/@AndrejKarpathy', name: 'AndrejKarpathy (YouTube)', platform: 'youtube', addedAt: 1765374197826 },
  { id: '1765374224114', url: 'https://x.com/karpathy', name: 'karpathy (X)', platform: 'twitter', addedAt: 1765374224114, pinned: true },
  { id: '1765374280117', url: 'https://www.youtube.com/@%E5%90%95%E4%BD%B3%E6%A5%A0', name: '吕佳楠 (YouTube)', platform: 'youtube', addedAt: 1765374280117 },
  { id: '1765374305013', url: 'https://www.youtube.com/@JustinSung', name: 'JustinSung (YouTube)', platform: 'youtube', addedAt: 1765374305013 },
  { id: '1765374319169', url: 'https://www.youtube.com/@Fireship', name: 'Fireship', platform: 'youtube', addedAt: 1765374319169 },
  { id: '1765374335389', url: 'https://www.youtube.com/@ycombinator', name: 'ycombinator', platform: 'youtube', addedAt: 1765374335389 },
  { id: '1765374356650', url: 'https://www.youtube.com/@xenosphereoriginals', name: 'xenosphereoriginals', platform: 'youtube', addedAt: 1765374356650 },
  { id: '1765374407869', url: 'https://www.youtube.com/@AWSEventsChannel', name: 'AWSEventsChannel (YouTube)', platform: 'youtube', addedAt: 1765374407869 },
  { id: '1765374428801', url: 'https://www.youtube.com/@Bg2Pod', name: 'Bg2Pod (YouTube)', platform: 'youtube', addedAt: 1765374428801 },
  { id: '1765374458186', url: 'https://www.youtube.com/@ChristinaAaliyah', name: 'ChristinaAaliyah (YouTube)', platform: 'youtube', addedAt: 1765374458186 },
  { id: '1765374478975', url: 'https://www.youtube.com/@raw.format', name: 'raw.format (YouTube)', platform: 'youtube', addedAt: 1765374478975 },
  { id: '1765374506210', url: 'https://www.youtube.com/@DanKoeTalks', name: 'DanKoeTalks (YouTube)', platform: 'youtube', addedAt: 1765374506210 },
  { id: '1765374526650', url: 'https://www.youtube.com/@cursor_ai', name: 'cursor_ai', platform: 'youtube', addedAt: 1765374526650 },
  { id: '1765374538562', url: 'https://www.youtube.com/@blockchaindailynews', name: 'blockchaindailynews (YouTube)', platform: 'youtube', addedAt: 1765374538562 },
  { id: '1765374560615', url: 'https://www.youtube.com/@DwarkeshPatel', name: 'DwarkeshPatel (YouTube)', platform: 'youtube', addedAt: 1765374560615 },
  { id: '1765374621060', url: 'https://www.youtube.com/@nspodcast', name: 'nspodcast (YouTube)', platform: 'youtube', addedAt: 1765374621060 },
  { id: '1765374668810', url: 'https://www.youtube.com/@RobertGreeneOfficial', name: 'RobertGreeneOfficial (YouTube)', platform: 'youtube', addedAt: 1765374668810 },
  { id: '1765374678870', url: 'https://www.youtube.com/@AltcoinDaily', name: 'AltcoinDaily (YouTube)', platform: 'youtube', addedAt: 1765374678870 },
  { id: '1765374696078', url: 'https://www.youtube.com/@rasmic', name: 'rasmic', platform: 'youtube', addedAt: 1765374696078 },
  { id: '1765374705457', url: 'https://www.youtube.com/@lidangzzz', name: 'lidangzzz (YouTube)', platform: 'youtube', addedAt: 1765374705457 },
  { id: '1765374725044', url: 'https://www.youtube.com/@DavidPerellChannel/videos', name: 'DavidPerellChannel (YouTube)', platform: 'youtube', addedAt: 1765374725044 },
  { id: '1765374745366', url: 'https://www.youtube.com/@AlexHormozi/videos', name: 'AlexHormozi (YouTube)', platform: 'youtube', addedAt: 1765374745366 },
  { id: '1765374765000', url: 'https://www.youtube.com/@TheDiaryOfACEO', name: 'TheDiaryOfACEO (YouTube)', platform: 'youtube', addedAt: 1765374765000 },
  { id: '1765374785506', url: 'https://www.youtube.com/@TravisMedia/videos', name: 'TravisMedia (YouTube)', platform: 'youtube', addedAt: 1765374785506 },
  { id: '1765374800690', url: 'https://www.youtube.com/@askvinh/videos', name: 'askvinh', platform: 'youtube', addedAt: 1765374800690 },
  { id: '1765374820720', url: 'https://www.youtube.com/@LennysPodcast', name: 'LennysPodcast (YouTube)', platform: 'youtube', addedAt: 1765374820720 },
  { id: '1765374847741', url: 'https://www.youtube.com/@NetNinja', name: 'NetNinja', platform: 'youtube', addedAt: 1765374847741 },
  { id: '1765374868776', url: 'https://www.youtube.com/@lexfridman', name: 'lexfridman (YouTube)', platform: 'youtube', addedAt: 1765374868776 },
  { id: '1765374889186', url: 'https://www.youtube.com/@timferriss/videos', name: 'timferriss (YouTube)', platform: 'youtube', addedAt: 1765374889186 },
  { id: '1765374938608', url: 'https://www.youtube.com/@joerogan', name: 'joerogan (YouTube)', platform: 'youtube', addedAt: 1765374938608 },
  { id: '1765374957756', url: 'https://www.youtube.com/@PeterMcCormackShow/videos', name: 'PeterMcCormackShow (YouTube)', platform: 'youtube', addedAt: 1765374957756 },
  { id: '1765374992053', url: 'https://www.youtube.com/@JordanBPeterson', name: 'JordanBPeterson (YouTube)', platform: 'youtube', addedAt: 1765374992053 },
  { id: '1765375007876', url: 'https://www.youtube.com/@ProductivePeter/videos', name: 'ProductivePeter (YouTube)', platform: 'youtube', addedAt: 1765375007876 },
  { id: '1765375057688', url: 'https://www.youtube.com/@gregcode/videos', name: 'gregcode (YouTube)', platform: 'youtube', addedAt: 1765375057688 },
  { id: '1765375079622', url: 'https://www.youtube.com/@shoshotw', name: 'shoshotw (YouTube)', platform: 'youtube', addedAt: 1765375079622 },
  { id: '1765375110957', url: 'https://www.youtube.com/@riandoris', name: 'riandoris', platform: 'youtube', addedAt: 1765375110957 },
  { id: '1765375131940', url: 'https://www.youtube.com/@RolloTomassi', name: 'RolloTomassi (YouTube)', platform: 'youtube', addedAt: 1765375131940 },
  { id: '1765375158623', url: 'https://www.youtube.com/@profjeffreykaplan/videos', name: 'profjeffreykaplan (YouTube)', platform: 'youtube', addedAt: 1765375158623 },
  { id: '1765375270889', url: 'https://www.youtube.com/@WilliamSaysX/videos', name: 'WilliamSaysX', platform: 'youtube', addedAt: 1765375270889 },
  { id: '1765375363757', url: 'https://www.youtube.com/@huangsiping/featured', name: 'huangsiping', platform: 'youtube', addedAt: 1765375363757 },
  { id: '1765375405796', url: 'https://www.youtube.com/@GoogleDevelopers', name: 'GoogleDevelopers (YouTube)', platform: 'youtube', addedAt: 1765375405796 },
  { id: '1765375417880', url: 'https://www.youtube.com/@%E9%8C%A2%E9%80%B2%E5%89%8D%E5%8D%81%E8%B6%B4PODCAST', name: '錢進前十趴PODCAST (YouTube)', platform: 'youtube', addedAt: 1765375417880 },
  { id: '1765375473364', url: 'https://www.youtube.com/@PhilosophyFreak/featured', name: 'PhilosophyFreak (YouTube)', platform: 'youtube', addedAt: 1765375473364 },
  { id: '1765375647628', url: 'https://www.youtube.com/@Corbin_Brown', name: 'Corbin_Brown (YouTube)', platform: 'youtube', addedAt: 1765375647628 },
  { id: '1765375860072', url: 'https://www.youtube.com/@DorianDevelops/videos', name: 'DorianDevelops (YouTube)', platform: 'youtube', addedAt: 1765375860072 },
  { id: '1765375917272', url: 'https://www.youtube.com/@AILABS-393', name: 'AILABS-393', platform: 'youtube', addedAt: 1765375917272 },
];

export const PLATFORM_ICONS: Record<string, string> = {
  youtube: 'https://cdn.simpleicons.org/youtube/ff0000',
  twitter: 'https://cdn.simpleicons.org/x/white',
  instagram: 'https://cdn.simpleicons.org/instagram/e4405f',
  github: 'https://cdn.simpleicons.org/github/white',
  other: 'https://cdn.simpleicons.org/rss/white',
};

export const detectPlatform = (url: string): Subscription['platform'] => {
  const lower = url.toLowerCase();
  if (lower.includes('youtube.com') || lower.includes('youtu.be')) return 'youtube';
  if (lower.includes('twitter.com') || lower.includes('x.com')) return 'twitter';
  if (lower.includes('instagram.com')) return 'instagram';
  return 'other';
};

/**
 * 从 URL 中提取频道/用户名称
 * 支持各种格式：
 * - YouTube: @handle, /c/name, /channel/id, /user/name
 * - Twitter/X: /username
 * - Instagram: /username
 */
export const extractCreatorName = (url: string): string => {
  try {
    const urlObj = new URL(url);
    const pathname = decodeURIComponent(urlObj.pathname);
    const platform = detectPlatform(url);
    
    if (platform === 'youtube') {
      // 处理 YouTube 各种格式
      // @handle 格式: youtube.com/@HackBear泰瑞
      const handleMatch = pathname.match(/^\/@([^/?]+)/);
      if (handleMatch) return handleMatch[1];
      
      // /c/name 格式: youtube.com/c/HackBear泰瑞
      const cMatch = pathname.match(/^\/c\/([^/?]+)/);
      if (cMatch) return cMatch[1];
      
      // /channel/ID 格式
      const channelMatch = pathname.match(/^\/channel\/([^/?]+)/);
      if (channelMatch) return `Channel: ${channelMatch[1].substring(0, 12)}...`;
      
      // /user/name 格式
      const userMatch = pathname.match(/^\/user\/([^/?]+)/);
      if (userMatch) return userMatch[1];
      
      return urlObj.hostname;
    }
    
    if (platform === 'twitter') {
      // twitter.com/username 或 x.com/username
      const twitterMatch = pathname.match(/^\/([^/?]+)/);
      if (twitterMatch && !['home', 'explore', 'notifications', 'messages', 'i'].includes(twitterMatch[1])) {
        return twitterMatch[1];
      }
      return urlObj.hostname;
    }
    
    if (platform === 'instagram') {
      // instagram.com/username
      const instaMatch = pathname.match(/^\/([^/?]+)/);
      if (instaMatch && !['explore', 'reels', 'stories', 'direct'].includes(instaMatch[1])) {
        return instaMatch[1];
      }
      return urlObj.hostname;
    }
    
    return urlObj.hostname;
  } catch (e) {
    console.error('Error extracting creator name:', e);
    return 'Unknown';
  }
};

/**
 * 标准化 URL，移除不必要的参数
 */
export const normalizeUrl = (url: string): string => {
  try {
    const urlObj = new URL(url);
    // 移除一些不必要的参数
    const paramsToRemove = ['app', 'feature', 'sub_confirmation'];
    paramsToRemove.forEach(param => urlObj.searchParams.delete(param));
    return urlObj.toString();
  } catch (e) {
    return url;
  }
};

/**
 * 验证 URL 是否是有效的订阅来源
 */
export const validateSubscriptionUrl = (url: string): { valid: boolean; error?: string } => {
  try {
    const urlObj = new URL(url);
    const platform = detectPlatform(url);
    
    if (platform === 'youtube') {
      // 检查是否是频道页面而不是视频页面
      if (urlObj.pathname.includes('/watch') || urlObj.pathname.includes('/shorts/')) {
        return { valid: false, error: '请输入 YouTube 频道主页链接，而不是视频链接' };
      }
    }
    
    if (platform === 'twitter') {
      // 检查是否是用户主页而不是具体推文
      if (urlObj.pathname.includes('/status/')) {
        return { valid: false, error: '请输入 Twitter 用户主页链接，而不是推文链接' };
      }
    }
    
    return { valid: true };
  } catch (e) {
    return { valid: false, error: '请输入有效的 URL' };
  }
};